# Crypto Trading на Polymarket — План и Идеи

## Текущая ситуация (2026-02-06)

BTC ~$70-72k. Рынок крайне медвежий после падения с ATH ($124,753).

Polymarket sentiment:
- 72% вероятность падения до $55k в 2026
- Только 44% вероятность возврата к $100k
- 99% ставят что $60k будет раньше $80k
- Только 27% шанс на новый ATH до конца 2026

---

## Типы рынков на Polymarket (Bitcoin)

| Тип | Пример | Горизонт | Ликвидность |
|-----|--------|----------|-------------|
| **Ценовые уровни** | "BTC hit $X before 2027?" | Месяцы | $13-30M объём |
| **Race markets** | "$60k or $80k first?" | Недели-месяцы | $50-100k |
| **ATH рынки** | "New ATH by Q2 2026?" | Кварталы | $1.7M |
| **Событийные** | "Satoshi moves BTC?" / "MSTR sells?" | Год | $0.8-20M |

---

## Стратегические идеи

### 1. Implied Distribution Extraction (приоритет: высший)

**Гипотеза:** Из цен "BTC above $X" контрактов на разных страйках ($55k, $60k, ..., $150k) можно извлечь implied PDF и сравнить с моделью на основе исторических returns. Расхождения = edge.

**Подход:**
- [ ] Извлечь implied PDF из цен контрактов (каждый страйк = точка CDF)
- [ ] Построить модель на основе GBM / исторических returns
- [ ] Сравнить implied vs model distribution
- [ ] Торговать хвосты где есть расхождение

**Пример:**
Если implied prob для "BTC > $110k" = 0.7%, а модель даёт 3% — покупать YES.

---

### 2. Контрарианская стратегия (приоритет: высокий)

**Гипотеза:** Polymarket чрезмерно реагирует на короткие движения BTC при оценке долгосрочных контрактов. После резких падений рынок слишком пессимистичен, после резких ростов — слишком оптимистичен.

**Механика:**
1. BTC падает на X% за неделю → паника
2. Долгосрочные контракты ("BTC > $100k до конца 2026") падают непропорционально сильно
3. Историческая статистика говорит что после таких падений BTC восстанавливается чаще, чем рынок закладывает
4. Покупаем недооценённые контракты, ждём нормализации sentiment

**Как строим модель (по истории BTC 2015-2026):**
- Для каждого дня: смотрим изменение BTC за последние 7 дней
- Группируем по размеру движения: -20%, -15%, -10%, +10%, +15%, +20%
- Для каждой группы считаем: куда пришёл BTC через 3 / 6 / 12 месяцев
- Получаем условные распределения: P(BTC > $Y | падение X% за неделю)
- Сравниваем с текущими ценами контрактов на Polymarket

**Торговые правила:**
- Триггер: BTC упал/вырос на X% за N дней
- Смотрим цены долгосрочных контрактов на Polymarket
- Считаем fair price по исторической модели
- Если edge (fair - market) > порог → входим
- Выход: продажа когда паника утихла и цена контракта вернулась к fair, или держим до резолюции

**Работает в обе стороны:**
- После падения: покупаем YES на рост (рынок слишком пессимистичен)
- После роста: покупаем YES на падение (рынок слишком оптимистичен)

**Что проверить в бэктесте:**
- [ ] Скачать историю BTC (daily, 2015-2026)
- [ ] Посчитать: после падения -10/-15/-20% за неделю, каково распределение через 3/6/12 мес?
- [ ] Сравнить условное распределение с безусловным — если разница мала, значит рынок переигрывает
- [ ] Калибровка: если Polymarket даёт 72% — сбывается ли это в 72% случаев?
- [ ] Определить оптимальные триггеры (какой размер падения/роста даёт лучший edge)

---

### 3. Cross-market арбитраж (приоритет: высокий)

**Гипотеза:** Цены между связанными рынками могут быть несогласованными. Безрисковая прибыль если найдём расхождения.

**Примеры несогласованности:**
- "BTC > $100k in 2026" = 44%, но "New ATH by Dec 2026" = 27%
  - ATH = $124,753, так что если $100k = 44%, то $125k должен быть ~25-30%
  - 27% выглядит адекватно, но стоит проверить по модели
- Месячные vs годовые контракты: path-dependency

**Что проверить:**
- [ ] Построить модель для связи цен разных контрактов
- [ ] Найти арбитражные или near-arbitrage ситуации
- [ ] Мониторить в реальном времени несогласованности между рынками

---

### 4. Vol арбитраж (приоритет: средний)

**Гипотеза:** Implied volatility из цен контрактов может расходиться с realized volatility из исторических данных.

**Что проверить:**
- [ ] Извлечь implied vol из цен контрактов на разных горизонтах
- [ ] Сравнить с realized vol за аналогичные периоды
- [ ] Торговать когда implied существенно выше или ниже realized

---

### 5. Tail Risk / Black Swan торговля (приоритет: низкий)

**Гипотеза:** Экстремальные исходы систематически недооценены или переоценены.

**Что интересно:**
- "BTC > $250k in 2026" = 4.2c — это дёшево или дорого?
- "BTC < $10k in 2026" = 7c — crypto winter scenario
- "Satoshi moves BTC" = 8.6c — чёрный лебедь

**Что проверить:**
- [ ] Историческая частота 3x-5x moves за год
- [ ] Fat tail distribution fitting (Student-t, Pareto)
- [ ] Стоимость портфеля из cheap tail bets

---

## Бэктесты — План

### Фаза 1: Сбор данных
- [ ] Исторические цены BTC (daily, hourly) — источники: Binance API, CoinGecko
- [ ] Исторические цены контрактов Polymarket (если доступно через API)
- [ ] On-chain метрики: ETF flows, exchange balances

### Фаза 2: Модели
- [ ] **GBM модель**: Geometric Brownian Motion с историческими параметрами
- [ ] **Fat-tail модель**: Student-t или Stable distribution
- [ ] **Regime-switching**: Bull/Bear/Sideways с Markov chain
- [ ] **Implied distribution extraction**: Из цен контрактов Polymarket

### Фаза 3: Бэктест стратегий
- [ ] Для каждой стратегии (1-5 выше) определить правила входа/выхода
- [ ] Прогнать на исторических данных (2020-2025)
- [ ] Метрики: Sharpe, max drawdown, win rate, avg edge
- [ ] Сравнить с baseline (buy and hold BTC, random)

### Фаза 4: Paper Trading
- [ ] Запустить лучшие стратегии в dry-run на живых данных Polymarket
- [ ] Отслеживать edge и P&L
- [ ] Итерировать модели

---

## Технический стек (переиспользование из earthquakes)

Из проекта earthquakes можно переиспользовать:
- `polymarket_client.py` — обёртка Polymarket API
- `trading_bot/executor/` — исполнение ордеров
- `trading_bot/ui/` — TUI для мониторинга
- `trading_bot/storage/` — хранение позиций

Нужно создать:
- `crypto/btc_model.py` — модели ценообразования
- `crypto/market_scanner.py` — поиск и парсинг крипто-рынков
- `crypto/backtest.py` — фреймворк для бэктестов
- `crypto/data/` — исторические данные

---

## Приоритеты

1. **Implied distribution extraction** — самый быстрый способ найти edge
2. **Контрарианская стратегия** — простая, высокий потенциал при текущем sentiment
3. **Cross-market арбитраж** — безрисковая прибыль если найдём несогласованности
4. **Vol арбитраж** — implied vs realized на средних горизонтах
5. **Tail risk** — дешёвые ставки на экстремальные исходы

---

## Ключевые находки из анализа

### Модель BTC (btc_model.ipynb)
- GBM + Student-t (df=2.17 full / df=2.95 recent), Monte Carlo 250k траекторий
- **σ(2015+) = 67.7%**, **σ(2023+) = 47.2%**
- Опционный рынок Deribit подтверждает σ ≈ 48-50% (Dec 2026 IV)
- Историческое μ(2023+) = +43% годовых → между "Умеренный" и "Бычий"

### Где edge
- **Upside**: edge зависит от матожидания (μ). При нашем μ=+27% — edge 3-27%. При μ=0 — edge исчезает. Вопрос убеждений, но опционный рынок тоже закладывает положительное μ.
- **Downside**: Polymarket переоценивает крахи **даже при μ=0**. BTC < $30k: модель 12.4% vs PM 24%. Это не субъективная оценка — это ошибка хвостовых рисков.
- **Аномалия Polymarket vs Deribit**: терминальная вероятность на опционах (Deribit) > touch вероятности на Polymarket для $120k+. Математически невозможно — подтверждает mispricing.

### Критика модели и ответы
- "Edge = твоё субъективное μ" → **на upside — да, на downside — нет** (edge при μ=0)
- "Субъективные веса гипотез" → **частично верно**, но чувствительность проверена, edge устойчив при разных весах
- Веса гипотез пока назначены интуитивно → **TODO: историческая калибровка весов**

### Валидация через Deribit
- Deribit API (бесплатный): `https://www.deribit.com/api/v2/public/get_book_summary_by_currency?currency=BTC&kind=option`
- Сравнение трёх источников (модель, Deribit, Polymarket) — модель и Deribit согласны, Polymarket — аутлайер
- **TODO**: автоматическое сравнение в ноутбуке (pull Deribit данные → overlay на графики)

### Управление рисками
- Контракты Polymarket — бинарные (0 или 1), вероятность полной потери 65-78%
- **Критерий Келли**: ставить 6-12% банкролла на один контракт
- **Лесенка по уровням**: распределить по нескольким страйкам ($100k/$120k/$150k) вместо одного
- **Комбо BTC спот + Polymarket**: 75% BTC спот, 12.5% Polymarket, 12.5% кэш
- **Точка выхода**: продавать когда рыночная цена контракта догоняет модельную (edge = 0), примерно при BTC $80-85k для контракта $150k
- **Временной стоп**: если через 4-6 месяцев BTC < $75k — выходить с убытком

---

## Заметки

- Polymarket берёт ~2% taker fee на покупках (учитывать в моделях!)
- Maker ордера (лимитки на продажу) = 0% fee
- Ликвидность на крипто-рынках значительно выше чем на землетрясениях
- Нужно следить за Binance BTC/USDT как source of truth для резолюции
- На дешёвых контрактах ($0.04-$0.11) ликвидность ограничена — slippage съест edge при крупных позициях
- Статья с полным разбором: `crypto/article_btc_polymarket.md`
