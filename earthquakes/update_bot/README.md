# Earthquake Markets Update Bot

TUI-бот для автоматического обновления конфигурации рынков землетрясений (`earthquake_markets.json`). Использует прямой доступ к Polymarket Gamma API для обновления списка активных рынков.

## Возможности

- **Прямая интеграция с Polymarket API**: никаких внешних зависимостей или API ключей
- **Автоматическая проверка** существующих рынков землетрясений
- **Периодическое обновление** каждые N часов (настраивается)
- **Обновление конфигурации** в `earthquake_markets.json`
- **TUI интерфейс** с логированием процесса в реальном времени
- **Умное обновление**: обновляет данные рынков, удаляет закрытые

## Требования

Нет специальных требований! Работает из коробки после установки зависимостей.

## Установка

### 1. Создание виртуального окружения

```bash
cd earthquakes
python3 -m venv .venv
source .venv/bin/activate
```

### 2. Установка зависимостей

**Рекомендуется:** Используйте общее окружение с trading_bot (покрывает все зависимости):
```bash
pip install -r trading_bot/requirements.txt
```

Или только для update_bot (минимальный набор):
```bash
pip install -r update_bot/requirements.txt
```

## Запуск

Из директории `earthquakes`:

```bash
# Активировать venv если ещё не активирован
source .venv/bin/activate

# Запуск с интервалом 6 часов (по умолчанию)
python -m update_bot

# Запуск с кастомным интервалом
python -m update_bot --interval 12h
```

## Параметры командной строки

| Флаг | Короткий | Описание | По умолчанию |
|------|----------|----------|--------------|
| `--interval` | `-i` | Интервал обновления (6h, 12h, 24h) | `6h` |
| `--markets-json` | | Путь к JSON файлу рынков | `earthquake_markets.json` |

## Примеры

```bash
# Обновление каждые 12 часов
python -m update_bot --interval 12h

# Кастомный путь к JSON
python -m update_bot --markets-json /path/to/markets.json
```

## Управление в TUI

| Клавиша | Действие |
|---------|----------|
| `Q` | Выход |
| `R` | Запустить обновление немедленно |

Интерфейс показывает:
- Количество отслеживаемых рынков
- Время последнего обновления
- Время до следующего обновления
- Лог операций в реальном времени

## Структура

```
update_bot/
├── __main__.py      # Точка входа
├── config.py        # Конфигурация и CLI
├── scanner.py       # Сканер рынков Polymarket
├── updater.py       # Обновление JSON
└── ui/
    └── app.py       # TUI интерфейс (Textual)
```

## Логика работы

1. **Проверка Claude API** - при старте проверяется доступность API ключа
2. **Периодическое обновление**:
   - Каждые N часов (настраивается через `--interval`)
   - Можно запустить вручную нажатием `R`
3. **Вызов Claude API**:
   - Формируется промпт с инструкциями для обновления JSON
   - Claude анализирует Polymarket Gamma API
   - Находит все рынки землетрясений
   - Обновляет `earthquake_markets.json`
4. **Вывод в реальном времени**: весь процесс работы Claude отображается в TUI
5. **Статистика**: показывается количество добавленных/обновлённых/удалённых рынков

**Если Claude API недоступен**: бот показывает ошибку и ждёт следующего таймера

## Формат earthquake_markets.json

```json
{
  "megaquake-by-january-31": {
    "magnitude": 8.0,
    "start": "2025-12-28T00:00:00Z",
    "end": "2026-01-31T23:59:59Z",
    "type": "binary"
  },
  "how-many-7pt0-or-above-earthquakes-in-2026": {
    "magnitude": 7.0,
    "start": "2026-01-01T00:00:00Z",
    "end": "2026-12-31T23:59:59Z",
    "type": "count",
    "outcomes": [
      ["<5", 0, 4],
      ["5-7", 5, 7],
      ["8-10", 8, 10],
      ["20+", 20, null]
    ]
  }
}
```

## Troubleshooting

**Ошибка "No markets found":**
Проверьте доступность Polymarket Gamma API.

**JSON не обновляется:**
Убедитесь, что файл `earthquake_markets.json` доступен для записи.

**TUI не отображается корректно:**
Убедитесь, что терминал поддерживает 256 цветов и Unicode.
